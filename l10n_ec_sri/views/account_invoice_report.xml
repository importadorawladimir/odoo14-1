<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<data>
		<!--Headers Layout-->

		<template id="external_layout_electronical_invoice_header">

        </template>
		<!--End Headers Layout-->

		<!--Footer Layout-->
		<template id="external_layout_electronical_invoice_footer">
            <div class="footer">
                <div class="text-center" style="border-top: 1px solid black;">
                    <ul class="list-inline" name="text-internal">
                        <li t-if="company.phone">Teléfono:
                            <span t-field="company.phone"/>
                        </li>
                        <li t-if="company.email">&amp;bull;</li>
                        <li t-if="company.email">Correo:
                            <span t-field="company.email"/>
                        </li>
                        <li t-if="company.website">&amp;bull;</li>
                        <li t-if="company.website">Web:
                            <span t-field="company.website"/>
                        </li>
                    </ul>
                    <ul class="list-inline">
                        <li>Página:</li>
                        <li>
                            <span class="page"/>
                        </li>
                        <li>/</li>
                        <li>
                            <span class="topage"/>
                        </li>
                    </ul>
                </div>
            </div>
        </template>


        <template id="external_layout_invoice_electronical">
            <t t-if="not o" t-set="o" t-value="doc"/>

            <t t-if="not company">
                <!-- Multicompany -->
                <t t-if="company_id">
                    <t t-set="company" t-value="company_id"/>
                </t>
                <t t-elif="o and 'company_id' in o and o.company_id.sudo()">
                    <t t-set="company" t-value="o.company_id.sudo()"/>
                </t>
                <t t-else="else">
                    <t t-set="company" t-value="res_company"/>
                </t>
            </t>
            <t t-call="web.basic_layout"><t t-raw="0"/></t>
        </template>

		<!--End Footer Layout-->

		<!-- RIDE Factura -->
		<template id="report_invoice_document">
            <t t-call="l10n_ec_sri.external_layout_invoice_electronical">
                <t t-set="o" t-value="o.with_context({'lang':o.partner_id.lang})" />
                <div class="page">
                    <div class="oe_structure"/>
                    <div class="row">
                        <div class="col-7">
                            <h1 t-if="o.company_id.logo" name="logo">
                                <img t-if="o.company_id.logo" t-att-src="image_data_uri(o.company_id.logo)" style="width:420px; height:130px; align:center;"/>
                            </h1>
                        </div>
                        <div class="col-5">
                            <div class="card">
                                <div class="text-center"
                                     style="color: #a94442;background-color: #f2dede; border-color: #ebccd1;padding: 5px;border-top-left-radius: 3px;border-top-right-radius: 3px;">
                                    <h4 t-if="o.move_type=='out_invoice'">FACTURA</h4>
                                    <h4 t-if="o.move_type=='out_refund' and o.l10n_latam_document_type_id.code == '04'">NOTA DE CRÉDITO</h4>
                                    <h4 t-if="o.move_type=='out_refund' and o.l10n_latam_document_type_id.code == '05'">NOTA DE DÉBITO</h4>
                                </div>
                                <table class="table table-bordered">
                                    <tr>
                                        <td>
                                            <h4>No: <span t-esc="o.l10n_latam_document_number[0:3]"></span>-<span
                                                    t-esc="o.l10n_latam_document_number[3:6]"></span>-
                                            </h4>
                                        </td>
                                        <td style="color: #a94442;">
                                            <h4>
                                                <span t-esc="o.l10n_latam_document_number[-9:]" style="font-size:20px"></span>
                                            </h4>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <!--<h1><a href=" "><img alt="" src="logo.png"/></a></h1>-->
                            <div class="card border-dark">
                                <div class="card-header">
                                    <h4 >
                                        <a href="#">
                                            <span t-field="o.company_id.name"/>
                                        </a>
                                    </h4>
                                </div>
                                <div class="card-body">
                                    <!--<span>
                                        <span t-esc="o.company_id.name"/>
                                    </span>-->
                                    <br/>
                                    <span>
                                        <b>RUC:</b>
                                        <span t-esc="o.company_id.vat"/>
                                    </span>
                                    <br/>
                                    <span>
                                        <b>Dir. Matriz:</b>
                                        <span t-field="o.company_id.street"/>
                                    </span>
                                    <br/>
                                    <span name="res_store">
                                        <b>Dir. Sucursal:</b>

                                        <t t-if="o.journal_id.dir_establecimiento">
                                            <span t-field="o.journal_id.dir_establecimiento"/>
                                        </t>
                                        <t t-else="else">
                                            <span t-field="o.company_id.street"/>
                                        </t>
                                    </span>
                                    <br/>
                                    <span t-if="o.company_id.is_special_taxpayer_number">
                                        <b>Contribuyente Especial Nro.:</b>
                                        <span t-field="o.company_id.special_taxpayer_number"/>
                                    </span>
                                    <br/>
                                    <span>
                                        <b>OBLIGADO LLEVAR CONTABILIDAD.:</b>
                                        <b>
                                            <t t-if="o.company_id.takes_accounting">SI</t>
                                            <t t-if="not o.company_id.takes_accounting">NO</t>
                                        </b>
                                    </span>
                                    <br/>
                                    <span t-if="o.company_id.agent_retention">
                                        <center>
                                            <b>Agente de Retencion segun Resolucion Nro.:</b>
                                            <span t-field="o.company_id.ar_number_resolution"/>
                                        </center>
                                    </span>
                                    <span t-if="o.company_id.regime_micro">
                                        <b>CONTRIBUYENTE REGIMEN MICROEMPRESAS</b>
                                    </span>
                                    <span t-if="o.company_id.regime_rimpe">
                                        <b>CONTRIBUYENTE REGIMEN RIMPE</b>
                                    </span>
                                </div>

                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card border-dark">
                                <div class="card-header">
                                    <h4>
                                        <a href="#">Autorización Electrónica</a>
                                    </h4>
                                </div>
                                <div class="card-body" >
                                     <span>
                                        <b>CLAVE DE ACCESO</b>
                                    </span>
                                    <br/>
                                    <span t-esc="o.get_edi_docuemnt_access_key()" class="text-center"/>
                                    <t t-set="auth" t-value="o.get_edi_docuemnt_auth()" />
                                    <t t-if="auth">
                                        <span>
                                            <b>Autorización:</b>
                                            <span t-field="auth.claveacceso"/>
                                        </span>
                                        <br/>
                                        <span>
                                            <b>Fecha/Hora:</b>
                                            <span t-field="auth.fechaautorizacion"/>
                                        </span>
                                        <br/>
                                        <span>
                                            <b>Ambiente:</b>
                                            <span t-field="auth.ambiente"/>
                                        </span>
                                        <br/>
                                        <span>
                                            <b>Emisión:</b>
                                            <span>NORMAL</span>
                                        </span>
                                    </t>

                                </div>
                            </div>
                        </div>
                    </div>
                    <br/>
                    <br/>
                    <div class="row">
                        <table class="table table-bordered table-sm">
                            <tr>
                                <td>
                                    <b>Razón Social/Nombres y Apellidos:</b>
                                    <span t-field="o.partner_id.name"/>
                                </td>
                                <td>
                                    <b>RUC/CI:</b>
                                    <span t-field="o.partner_id.vat"/>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <b>Fecha de Emisión:</b>
                                    <span t-field="o.invoice_date"/>
                                </td>
                            </tr>
                            <tr t-if="o.move_type=='out_refund'">
                                <td colspan="2">
                                    <b>Comprobante que se modifica</b>
                                </td>
                            </tr>
                            <tr t-if="o.move_type=='out_refund'">
                                <td>
                                    <b>Fecha de emisión:</b>
                                    <span t-esc="o.l10n_latam_document_sustento_id.invoice_date"/>
                                </td>
                                <td>
                                    <b>Factura:</b>
                                    <span t-field="o.l10n_latam_document_sustento_id.l10n_latam_document_number"/>
                                </td>
                            </tr>
                            <tr t-if="o.move_type=='out_refund'">
                                <td colspan="2">
                                    <b>Razón de la modificación:</b>
                                    <span t-field="o.ref"/>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <div class="row">
                        <table class="table table-bordered table-sm">
                            <thead>
                                <tr class="table-primary">
                                    <th scope="col" style="width: 70px !important;">
                                        <h5>Código</h5>
                                    </th>
                                    <th scope="col">
                                        <h5>Descripción</h5>
                                    </th>
                                    <th scope="col">
                                        <h5>Cantidad</h5>
                                    </th>
                                    <th scope="col">
                                        <h5>Precio</h5>
                                    </th>
                                    <th scope="col">
                                        <h5>Descuento</h5>
                                    </th>
                                    <th scope="col">
                                        <h5>Sub-Total</h5>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach="o.invoice_line_ids" t-as="l">
                                    <td>
                                        <span t-field="l.product_id.default_code"/>
                                    </td>
                                    <td>
                                        <t t-if='l.product_id'>
                                                <span t-field="l.product_id.name"/>
                                            </t>
                                            <t t-if='not l.product_id'>
                                                <span t-field="l.name"/>
                                            </t>

                                    </td>
                                    <td class="text-right">
                                        <t t-esc="'{0:.2f}'.format(l.quantity).replace('.', ',')" />
                                    </td>
                                    <td class="text-right">
                                        <span t-field="l.price_unit"
                                              t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                                    </td>
                                    <td class="text-right">
                                        <span>0.00</span>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="l.price_subtotal"
                                              t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                    <div class="row">
                        <div class="col-7">
                            <div class="card" t-if="o.move_type=='out_invoice'">
                                <div class="card-header">
                                    <h4>Información Adicional</h4>
                                </div>
                                <table class="table table-bordered table-sm">
                                    <t t-if="o.partner_id.email" name="mail">
                                        <tr>
                                            <th>Correo</th>
                                            <td colspan="3">
                                                <span t-field="o.partner_id.email"/>
                                            </td>
                                        </tr>
                                    </t>
                                    <t t-if="o.partner_id.street" name="address">
                                        <tr>
                                            <th>Dirección</th>
                                            <td colspan="4">
                                                <span t-field="o.partner_id.street"/>
                                            </td>
                                        </tr>

                                    </t>
                                    <t t-if="o.narration" name="comment">
                                        <tr>
                                            <th colspan="4">Otra Información</th>
                                        </tr>
                                        <tr>
                                            <td colspan="4">
                                                <span t-field="o.narration"/>
                                            </td>
                                        </tr>
                                    </t>
                                </table>

                            </div>
                        </div>
                        <div class="col-1"/>
                        <div class="col-4  align-self-end">
                            <table class="table table-bordered table-sm">
                                <tr>
                                    <th>Subtotal sin Impuestos:</th>
                                    <td class="text-right">
                                        <span t-field="o.amount_untaxed"
                                              t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                                    </td>
                                </tr>
                                <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                                        <tr style="">
                                            <t t-if="len(o.line_ids.filtered(lambda line: line.tax_line_id)) in [0, 1] and float_compare(o.amount_untaxed, amount_by_group[2], precision_rounding=o.currency_id.rounding) == 0">
                                                <td><span class="text-nowrap" t-esc="amount_by_group[0]"/></td>
                                                <td class="text-right o_price_total">
                                                    <span class="text-nowrap" t-esc="amount_by_group[3]" />
                                                </td>
                                            </t>
                                            <t t-else="">
                                                <td>
                                                    <span t-esc="amount_by_group[0]"/>
                                                    <span class="text-nowrap"> on
                                                        <t t-esc="amount_by_group[4]"/>
                                                    </span>
                                                </td>
                                                <td class="text-right o_price_total">
                                                    <span class="text-nowrap" t-esc="amount_by_group[3]"/>
                                                </td>
                                            </t>
                                        </tr>
                                    </t>
                                <tr>
                                    <th>Total a pagar:</th>
                                    <td class="text-right">
                                        <span t-field="o.amount_total"
                                              t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                                    </td>
                                </tr>
                            </table>

                        </div>

                    </div>
                </div>

            </t>

        </template>

		<!-- End RIDE Factura -->
    	<template id="report_einvoice">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-set="lang" t-value="o.invoice_user_id.sudo().lang if o.move_type in ('in_invoice', 'in_refund') else o.partner_id.lang"/>
                    <t t-call="l10n_ec_sri.report_invoice_document" t-lang="lang"/>
                </t>
            </t>
        </template>

        <!--<record id="report_factura_electronica_id" model="ir.actions.report">
	        <field name="paperformat_id" ref="ride_format" />
        </record>-->

		<report id="report_factura_electronica_id" model="account.move"
			    string="Factura electrónica" name="l10n_ec_sri.report_einvoice"
			    file="RIDE" report_type="qweb-pdf" />


    </data>
</odoo>
