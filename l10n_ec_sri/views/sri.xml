<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <menuitem
        id="menu_documentos_electronicos"
        name="Documentos electronicos"
        parent="account.menu_finance_entries"
        sequence="20"
        />

    <record id="documento_electronico_form_view" model="ir.ui.view">
        <field name="name">SRI_documento_electronico_form_view</field>
        <field name="model">account.edi.document</field>
        <field name="arch" type="xml">
            <form edit="0" create="0" delete="0">
                <header>
                    <button
                        attrs="{'invisible':[('state', 'not in', ('received','in_process'))]}"
                        name="receive_de_offline"
                        string="VERIFICAR RESPUESTA"
                        type="object"/>
                    <button
                        attrs="{'invisible':[('state', '!=', 'to_send')]}"
                        name="send_de_backend"
                        string="ENVIAR DOCUMENTO"
                        type="object"/>
                    <field name="state" widget="statusbar" statusbar_visible="to_send,sent,cancelled,received,in_process,return,autorized"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="move_id"/>
                            <field name="tipoemision"/>
                            <field name="ambiente"/>
                        </group>
                        <group>
                            <field name="claveacceso"/>
                            <field name="fechaautorizacion"/>
                            <field name="edi_format_id"/>
                        </group>
                    </group>
                    <group col="4" string="Mensaje" attrs="{'invisible':[('error','=',False)]}">
                         <field name="error"/>
                    </group>
                    <group col="4" string="Archivos" attrs="{'invisible':[('xml_file','=',False),('ride_file','=',False)]}">
                         <field name="xml_file" filename="xml_filename"/>
                        <field name="ride_file" filename="ride_filename"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

     <record id="documento_electronico_tree_view" model="ir.ui.view">
        <field name="name">SRI_documento_electronico_tree_view</field>
        <field name="model">account.edi.document</field>
        <field name="arch" type="xml">
            <tree string="Documento electronico" create="0" delete="0">
                <field name="move_id"/>
                <field name="l10n_latam_document_type_id"/>
                <field name="tipoemision"/>
                <field name="ambiente"/>
                <field name="claveacceso"/>
                <field name="error"/>
                <field name="state"/>
            </tree>
        </field>
    </record>
    <record id="documento_electronico_search_view" model="ir.ui.view">
       <field name="name">SRI_documento_electronico_search_view</field>
       <field name="model">account.edi.document</field>
        <field name="arch" type="xml">
            <search string="Search">
                <field name="move_id"/>
                <field name="tipoemision"/>
                <field name="ambiente"/>
                <field name="claveacceso"/>
                <field name="state"/>
                <filter string="Ambiente" name="ambiente" domain="[]" context="{'group_by': 'ambiente'}"/>
                <filter string="Estado" name="state" domain="[]" context="{'group_by': 'state'}"/>
                <filter string="Tipo de Documento" name="state" domain="[]" context="{'group_by': 'l10n_latam_document_type_id'}"/>
            </search>
       </field>
    </record>

    <record id="action_documento_electronico" model="ir.actions.act_window">
        <field name="name">Consola de Documentos Electrónicos</field>
        <field name="res_model">account.edi.document</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="documento_electronico_search_view"/>
        <field name="view_id" ref="documento_electronico_tree_view"/>
        <field name="domain">[('edi_format_id.code', '=', 'FESRI'),('state','!=', False)]</field>
    </record>


    <menuitem
        id="menu_documento_electronico_queue"
        name="Consola de Documentos Electrónicos"
        parent="menu_documentos_electronicos"
        sequence="100"
        action="action_documento_electronico"
        />

    <record id="action_documento_electronico_send" model="ir.actions.act_window">
        <field name="name">Consola de Correos Electrónicos</field>
        <field name="res_model">account.edi.document</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="documento_electronico_search_view"/>
        <field name="view_id" ref="documento_electronico_tree_view"/>
        <field name="domain">[('edi_format_id.code', '=', 'FESRI'),('mail_send','=',False),('state','=','autorized')]</field>
    </record>


    <menuitem
        id="menu_documento_electronico_queue_send"
        parent="menu_documentos_electronicos"
        sequence="101"
        action="action_documento_electronico_send"
        />

    <!--Documentos de retencion-->
    <!-- Inherit Form View to Modify it -->
    <record id="view_account_retention_einvoice_form" model="ir.ui.view">
        <field name="name">account.retention.einvoice</field>
        <field name="model">account.retention</field>
        <field name="inherit_id" ref="ek_l10n_ec_withdrawing.view_account_retention_form"/>
        <field name="arch" type="xml">

            <xpath expr="//page[@name='taxed']" position="after">
                <page id="edi_documents" string="Documentos EDI" attrs="{'invisible': [('edi_document_ids', '=', [])]}">
                    <field name="edi_document_ids">
                        <tree create="false" delete="false" edit="false" decoration-danger="error">
                            <field name="name"/>
                            <field name="edi_format_name"/>
                            <field name="state"/>
                            <field name="error" invisible="0"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
